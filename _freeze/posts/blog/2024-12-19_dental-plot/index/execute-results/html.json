{
  "hash": "f247327d1aaf62f18a793a9405571c78",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: (To) Plotting Dental Inventory with ggplot2\nimage: /images/dental-inv-plot.png\ncategories: [R, dental-anthropology]\ndate: \"2024-12-19\"\ndate-modified: last-modified\nauthor: Bjørn\ndescription: A tutorial on plotting dental data in ggplot2.\ntoc: true\n---\n\n\n\n\n\n\nThis is a tutorial on an intuitive (or at very least, pretty) way to visualise\ndental inventory in a sample. It requires only a basic knowledge of R, and, of\ncourse, that you have installed it along with RStudio.\n\nRequired packages:\n\n- tidyverse\n- patchwork\n\nTo install the packages (if needed):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(c(\"tidyverse\", \"patchwork\"))\n```\n:::\n\n\n\n\n### Load data and packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(patchwork)\ndental_inv <- readr::read_csv(\"https://raw.githubusercontent.com/bbartholdy/dental-inv-plot/main/data/dental-inv.csv\")\n```\n:::\n\n\n\n\nThe variables are:\n\n| variable name | description |\n|----|----|\n| id | skeletal identifier |\n| t11:18; t21:28; t31:38; t41:48 | status of tooth (t + FDI notation). <br> p = present; m = missing; dna = removed for dna sampling; aml = antemortem loss. |\n\n![https://www.careforsmiles.com.au/images/FDI-tooth-numbering-adult.png](./img/FDI-tooth-numbering-adult.png)\n\n### Convert data to long format\n\nFirst step is to convert the data to long format with the `pivot_longer` function.\nThis will take all of the tooth columns and combine them to two columns; one with\nthe tooth name, and one with the tooth status.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndental_inv_long <- dental_inv %>%\n  pivot_longer(-id, names_to = \"tooth\", values_to = \"status\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndental_inv_long %>%\n  slice_head(n = 10) # show first 10 entries\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 3\n   id    tooth status\n   <chr> <chr> <chr> \n 1 id08  t11   p     \n 2 id08  t12   p     \n 3 id08  t13   m     \n 4 id08  t14   p     \n 5 id08  t15   p     \n 6 id08  t16   p     \n 7 id08  t17   p     \n 8 id08  t18   m     \n 9 id08  t21   p     \n10 id08  t22   m     \n```\n\n\n:::\n:::\n\n\n\n\nIt would also be useful to have a column that indicates to which region of the \nmouth the tooth belongs.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmaxilla <- c(paste0(\"t\", 11:18), paste0(\"t\", 21:28))\nleft <- c(paste0(\"t\", 21:28), paste0(\"t\", 31:38))\n\ndental_inv_long <- dental_inv %>%\n  pivot_longer(\n    t11:t48, names_to = \"tooth\",\n    values_to = \"status\"\n  ) %>%\n   mutate(\n    region = if_else(tooth %in% maxilla, \"maxilla\", \"mandible\"), \n    side = if_else(tooth %in% left, \"left\", \"right\"), .before = status\n  )\n```\n:::\n\n\n\n\n\n### Prepare separate plots\n\nIndicate order of the teeth in each region as in the FDI diagram shown above. \nstarting from the upper right third molar. We will use this to reorder the \nteeth shown in the plot.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nupper_order <- c(paste0(\"t\", 18:11), paste0(\"t\", 21:28))\nlower_order <- c(paste0(\"t\", 48:41), paste0(\"t\", 31:38))\nupper_order\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"t18\" \"t17\" \"t16\" \"t15\" \"t14\" \"t13\" \"t12\" \"t11\" \"t21\" \"t22\" \"t23\" \"t24\"\n[13] \"t25\" \"t26\" \"t27\" \"t28\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlower_order\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"t48\" \"t47\" \"t46\" \"t45\" \"t44\" \"t43\" \"t42\" \"t41\" \"t31\" \"t32\" \"t33\" \"t34\"\n[13] \"t35\" \"t36\" \"t37\" \"t38\"\n```\n\n\n:::\n:::\n\n\n\n\n\nThe plots for the maxilla and mandible are prepared separately, then combined\nwith the [**patchwork**](https://patchwork.data-imaginist.com/) package.\n\nFirst, the plot of the maxillary dentition:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot for the maxillary dentition\nmaxilla_pl <- dental_inv_long %>%\n  filter(region == \"maxilla\") %>% # we only want maxillary teeth\n  mutate(tooth = factor(tooth, levels = upper_order)) %>% # make sure the order on the plot is according to the order the teeth are positioned in the mouth\n  ggplot(aes(x = tooth, fill = status)) +\n    geom_bar(position = \"stack\") + # stacked bar plot\n    scale_x_discrete(position = \"top\") + # move x-axis text to top\n    scale_fill_viridis_d() # colour-blind-friendly pallette\n\nmaxilla_pl\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\nThen, the plot of the mandibular dentition:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot for the mandibular dentition\nmandible_pl <- dental_inv_long %>%\n  filter(region == \"mandible\") %>%\n  mutate(tooth = factor(tooth, levels = lower_order)) %>%\n  ggplot(aes(x = tooth, fill = status)) +\n    geom_bar(position = \"stack\") +\n    scale_fill_viridis_d()\n\nmandible_pl\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### Combine plots\n\n**UPDATE:** The two dental plots are combined using the **patchwork** package. \nThanks [\\@jfy133](https://genomic.social/@jfy133) for bringing it to my \nattention! (and of course [\\@thomasp85](https://fosstodon.org/@thomasp85), the \npackage developer).\n\nWe will combine them using `/` instead of `+`, because we want one on top of the\nother to mimic the maxilla's and mandible's position in the mouth:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmaxilla_pl / mandible_pl\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\nThe `plot_layout()` function allows us to easily combine the shared\nlegends and axes. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmaxilla_pl / mandible_pl + plot_layout(guides = \"collect\", axis_titles = \"collect\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n\nWe can also add shared theme elements\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmaxilla_pl / mandible_pl + \n  plot_layout(guides = \"collect\", axis_titles = \"collect\") & \n  theme_minimal() +\n  theme(\n    panel.grid = element_blank(),\n    axis.title.x.top = element_blank() # remove the extra x-axis title\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\nAnd done! This gives (in my opinion) a nice, intuitive overview of the dental\ninventory in a sample, and could also be used to look at dental diseases \n(caries, calculus, periodontitis, etc).\n\n\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}